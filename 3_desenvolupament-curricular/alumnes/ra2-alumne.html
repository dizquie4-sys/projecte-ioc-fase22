<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RA2 ¬∑ Investigaci√≥ d'accidents + Avaluaci√≥ de riscos</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        /* ESTILS COMPLETS (exactament igual que l'original) */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Arial, sans-serif;
        }
        body {
            background: linear-gradient(135deg, #f5f5f5 0%, #e9ecef 100%);
            padding: 30px;
            color: #212529;
        }
        .container {
            max-width: 1100px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(209,34,43,0.15);
            overflow: hidden;
        }
        .header {
            background: #D1222B;
            padding: 25px;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        .header h1 {
            font-size: 2rem;
            margin-bottom: 5px;
        }
        .header .accessibility-icon {
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: white;
            border: 2px solid white;
        }
        .content {
            padding: 30px 35px;
        }
        .badge-groc {
            background: #FFC72C;
            color: #1e293b;
            padding: 8px 18px;
            border-radius: 40px;
            font-weight: 700;
            font-size: 1rem;
            display: inline-block;
            margin-bottom: 20px;
            border: 2px solid #D1222B;
        }
        .section-title {
            font-size: 1.8rem;
            color: #D1222B;
            border-left: 8px solid #FFC72C;
            padding-left: 18px;
            margin: 30px 0 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        .section-title .help-btn {
            background: #FFC72C;
            color: #D1222B;
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        .section-title .help-btn:hover {
            background: #D1222B;
            color: white;
        }
        .info-box {
            background: #fff1f0;
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            border-left: 5px solid #D1222B;
        }
        .info-box h3 {
            color: #D1222B;
            margin-bottom: 10px;
        }
        .btn {
            background: white;
            border: 2px solid #D1222B;
            color: #D1222B;
            padding: 10px 20px;
            border-radius: 40px;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin: 5px;
            transition: all 0.2s;
            text-decoration: none;
        }
        .btn:hover, .btn:focus {
            background: #D1222B;
            color: white;
            outline: 3px solid #FFC72C;
        }
        .btn-primary {
            background: #D1222B;
            color: white;
        }
        .btn-primary:hover, .btn-primary:focus {
            background: #b01e25;
            border-color: #b01e25;
        }
        .btn-danger {
            background: #6c757d;
            color: white;
            border: none;
        }
        .btn-success {
            background: #28a745;
            color: white;
            border: none;
        }
        .btn-secondary {
            background: #6c757d;
            color: white;
            border: none;
        }
        .btn-close {
            background: #6c757d;
            color: white;
            border: none;
        }
        .btn-close:hover {
            background: #5a6268;
        }
        .buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 20px 0;
            justify-content: center;
        }
        textarea, input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ffd9d9;
            border-radius: 12px;
            margin: 8px 0 15px;
            font-size: 1rem;
        }
        textarea:focus, input:focus, select:focus {
            outline: 3px solid #FFC72C;
            border-color: #D1222B;
        }
        .required::after {
            content: " *";
            color: #D1222B;
            font-weight: bold;
        }
        .scale-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }
        .scale-item {
            flex: 1;
            min-width: 180px;
            padding: 15px;
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .scale-item:hover, .scale-item:focus {
            background: #fff1f0;
            border-color: #D1222B;
            outline: none;
        }
        .scale-item.selected {
            background: #fff1f0;
            border-color: #D1222B;
            box-shadow: 0 0 0 3px rgba(209,34,43,0.2);
        }
        .level-icon {
            width: 28px; height: 28px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            color: white;
            margin-right: 10px;
            font-weight: bold;
        }
        .level-1 { background: #e74c3c; }
        .level-2 { background: #f39c12; }
        .level-3 { background: #2ecc71; }
        .level-4 { background: #D1222B; }
        .results-area {
            background: #f8fafc;
            border-radius: 20px;
            padding: 25px;
            margin: 30px 0;
            border: 2px solid #D1222B;
            display: none;
        }
        .score-badge {
            font-size: 2rem;
            font-weight: 700;
            color: #2c3e50;
        }
        .json-container {
            max-height: 200px;
            overflow-y: auto;
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 10px;
            font-family: monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
            margin: 10px 0;
        }
        .footer {
            background: #f1f5f9;
            padding: 20px;
            text-align: center;
        }
        hr {
            border: 2px dashed #FFC72C;
            margin: 30px 0;
        }
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            border: 0;
        }
        .autoavaluacio-container {
            background: #f8fafc;
            border-radius: 20px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid #FFC72C;
            display: none;
        }
        .quiz-item {
            margin-bottom: 20px;
        }
        .quiz-question {
            font-weight: 600;
            margin-bottom: 10px;
        }
        .quiz-options {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        .quiz-options label {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
        }
        .quiz-options input[type="radio"] {
            width: auto;
            margin: 0;
        }
        .feedback-quiz {
            margin-top: 10px;
            padding: 10px;
            border-radius: 10px;
            display: none;
        }
        .enllac-normativa {
            display: inline-block;
            background: #f0f7ff;
            border: 1px solid #D1222B;
            border-radius: 20px;
            padding: 5px 15px;
            margin: 5px;
            color: #D1222B;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.2s;
        }
        .enllac-normativa:hover {
            background: #D1222B;
            color: white;
            text-decoration: none;
        }
        .enllac-ntp {
            display: inline-block;
            background: #e9ecef;
            border: 1px solid #6c757d;
            border-radius: 20px;
            padding: 5px 15px;
            margin: 5px;
            color: #495057;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.2s;
        }
        .enllac-ntp:hover {
            background: #D1222B;
            color: white;
            border-color: #D1222B;
            text-decoration: none;
        }
        .info-links {
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }
        .plantilla-link {
            display: inline-block;
            background: #d4edda;
            border: 1px solid #28a745;
            border-radius: 20px;
            padding: 5px 15px;
            margin: 5px;
            color: #155724;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.2s;
        }
        .plantilla-link:hover {
            background: #28a745;
            color: white;
            text-decoration: none;
        }
        .pla-simplificat {
            background: #fff3cd;
            border: 1px solid #856404;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }
        .model-visual {
            background: white;
            border: 2px solid #D1222B;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            font-family: monospace;
        }
        .rubrica-visual {
            background: #f8fafc;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid #FFC72C;
        }
        .rubrica-visual table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        .rubrica-visual th {
            background: #D1222B;
            color: white;
            padding: 10px;
            font-size: 0.9rem;
        }
        .rubrica-visual td {
            border: 1px solid #ffd9d9;
            padding: 8px;
            font-size: 0.85rem;
        }
        .rubrica-visual .nivell-1 { background: #f8d7da; }
        .rubrica-visual .nivell-2 { background: #fff3cd; }
        .rubrica-visual .nivell-3 { background: #d4edda; }
        .rubrica-visual .nivell-4 { background: #D1222B; color: white; }
        
        .examen-container {
            background: #f0f7ff;
            border-radius: 20px;
            padding: 25px;
            margin: 20px 0;
            border: 3px solid #D1222B;
            display: none;
        }
        .examen-pregunta {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 5px solid #FFC72C;
        }
        .examen-pregunta p {
            margin-bottom: 10px;
        }
        .examen-opcions {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin: 10px 0;
        }
        .examen-opcions label {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
        }
        .examen-opcions input[type="radio"] {
            width: auto;
            margin: 0;
        }
        .examen-feedback {
            margin-top: 8px;
            padding: 8px;
            border-radius: 5px;
            font-size: 0.9rem;
            display: none;
        }
        .examen-correcte {
            background: #d4edda;
            color: #155724;
        }
        .examen-incorrecte {
            background: #f8d7da;
            color: #721c24;
        }
        .examen-resultat {
            background: #fff3cd;
            border-radius: 15px;
            padding: 15px;
            margin: 20px 0;
            text-align: center;
            font-size: 1.3rem;
            font-weight: bold;
        }
        .examen-superat {
            background: #d4edda;
            color: #155724;
        }
        .examen-no-superat {
            background: #f8d7da;
            color: #721c24;
        }
        
        /* ESTILS PER ALS MODALS */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 20px;
            width: 80%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            border: 3px solid #D1222B;
            position: relative;
        }
        .close-modal {
            color: #D1222B;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            position: sticky;
            top: 0;
            background: white;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            border: 2px solid #D1222B;
        }
        .close-modal:hover {
            background: #D1222B;
            color: white;
        }
        .modal h2 {
            color: #D1222B;
            margin-bottom: 20px;
        }
        .modal h3 {
            color: #D1222B;
            margin: 20px 0 10px;
        }
        .modal ul {
            margin-left: 20px;
            margin-bottom: 15px;
        }
        .modal li {
            margin-bottom: 5px;
        }

        /* ESTILS PER ALS BLOCS DESPLEGABLES */
        .bloc-container {
            background: #f8fafc;
            border-radius: 20px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid #FFC72C;
            display: none;
        }
        .bloc-title {
            color: #D1222B;
            margin-bottom: 15px;
        }
        
        /* MODAL D'EXPLICACI√ì JSON */
        .modal-explicacio {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        .modal-explicacio-content {
            background-color: white;
            margin: 10% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            border: 3px solid #D1222B;
            position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .modal-explicacio-tancar {
            color: #D1222B;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            border: 2px solid #D1222B;
        }
        .modal-explicacio-tancar:hover {
            background: #D1222B;
            color: white;
        }
        
        /* BOT√ì FLOTANT ACCESSIBLE */
        .btn-flotant {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 9999;
            background: #FFC72C;
            color: #D1222B;
            border: 2px solid #D1222B;
            border-radius: 50px;
            padding: 12px 20px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            min-width: 60px;
            min-height: 60px;
            line-height: 1;
        }
        .btn-flotant:hover,
        .btn-flotant:focus {
            background: #D1222B;
            color: white;
            outline: 3px solid #FFC72C;
            outline-offset: 2px;
            transform: scale(1.05);
        }
        .btn-flotant:focus-visible {
            outline: 3px solid #FFC72C;
            box-shadow: 0 0 0 5px rgba(209,34,43,0.3);
        }
    </style>
</head>
<body>
    <!-- BOT√ì FLOTANT ACCESSIBLE PER TORNAR A DALT -->
    <button 
        class="btn-flotant" 
        id="tornarDaltBtn" 
        title="Tornar a l'inici de la p√†gina"
        aria-label="Tornar a dalt"
        role="button"
        tabindex="0">
        ‚¨ÜÔ∏è <span class="sr-only">Tornar a dalt</span>
    </button>

    <!-- MODAL D'EXPLICACI√ì DEL JSON -->
    <div id="modalExplicacio" class="modal-explicacio">
        <div class="modal-explicacio-content">
            <span class="modal-explicacio-tancar">&times;</span>
            <h2 style="color:#D1222B; margin-bottom:20px;">üì§ Com enviar el teu treball</h2>
            
            <div style="margin:20px 0; padding:15px; background:#f0f7ff; border-radius:10px; border-left:5px solid #D1222B;">
                <p style="font-size:1.1rem; margin-bottom:10px;"><strong>üìÅ Qu√® √©s un fitxer JSON?</strong></p>
                <p>√âs un format que cont√© TOTES les teves respostes en un sol fitxer. El professor el podr√† llegir f√†cilment.</p>
            </div>
            
            <div style="margin:20px 0; padding:15px; background:#fff3cd; border-radius:10px; border-left:5px solid #FFC72C;">
                <p style="font-size:1.1rem; margin-bottom:10px;"><strong>üì• Com el guardes?</strong></p>
                <ol style="margin-left:20px;">
                    <li>Omple totes les preguntes</li>
                    <li>Prem el bot√≥ <strong>"Preparar per enviar"</strong></li>
                    <li>Prem <strong>"üìä Exportar JSON"</strong></li>
                    <li>El fitxer es desar√† a la carpeta <strong>Desc√†rregues</strong></li>
                </ol>
            </div>
            
            <div style="margin:20px 0; padding:15px; background:#d4edda; border-radius:10px; border-left:5px solid #28a745;">
                <p style="font-size:1.1rem; margin-bottom:10px;"><strong>üì§ Com l'envies al professor?</strong></p>
                <ul style="margin-left:20px;">
                    <li><strong>Moodle:</strong> Puja'l com a tasca</li>
                    <li><strong>Correu:</strong> Adjunta'l a un missatge</li>
                    <li><strong>Drive:</strong> Comparteix l'enlla√ß</li>
                </ul>
            </div>
            
            <div style="text-align:center; margin-top:25px;">
                <button class="btn btn-primary" id="tancarModalBtn">Ent√®s</button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <div>
                <h1 id="main-title">‚ö° RA2 ¬∑ Investigaci√≥ d'accidents + Avaluaci√≥ de riscos</h1>
                <p>FOL ‚Äì IPO I ¬∑ CFGM Instal¬∑lacions El√®ctriques</p>
            </div>
            <div class="accessibility-icon" role="img" aria-label="Presentaci√≥ accessible" title="Aquest contingut compleix criteris d'accessibilitat WCAG 2.1">
                ‚ôø
            </div>
        </div>
        <div class="content">
            <!-- Botons de la cap√ßalera -->
            <div style="display: flex; gap: 10px; justify-content: flex-end; flex-wrap: wrap; margin-bottom: 20px;">
                <button class="btn btn-primary" id="pdfInstruccionsBtn">
                    üì• PDF Instruccions completes
                </button>
                <button class="btn btn-primary" id="modalPortafolisBtn">
                    üìã Instruccions del portafolis
                </button>
            </div>

            <!-- MODAL INSTRUCCIONS PORTAFOLIS -->
            <div id="modalPortafolis" class="modal">
                <div class="modal-content">
                    <span class="close-modal">&times;</span>
                    <h2>üìã INSTRUCCIONS DEL PORTAFOLIS DIGITAL PROFESSIONAL</h2>
                    
                    <h3>Qu√® √©s el portafolis?</h3>
                    <p>El portafolis digital √©s una recopilaci√≥ de les teves evid√®ncies d'aprenentatge al llarg del m√≤dul. Ha de mostrar la teva evoluci√≥ i les teves compet√®ncies professionals.</p>
                    
                    <h3>Contingut obligatori:</h3>
                    <ul>
                        <li><strong>RA1 (Coneix el teu sector):</strong> Informe d'an√†lisi ocupacional</li>
                        <li><strong>RA2 (Investigaci√≥ d'accidents):</strong> Informe d'investigaci√≥ + Avaluaci√≥ de riscos</li>
                        <li><strong>RA3 (De l'oferta al conveni):</strong> Taula de contrast + conclusions grupals</li>
                        <li><strong>RA4 (El meu perfil professional):</strong> DAFO + Full de ruta</li>
                        <li><strong>RA5 (Identitat digital):</strong> PLE + Reflexi√≥ identitat digital + CV digital</li>
                        <li><strong>Reflexi√≥ global:</strong> Connexions entre els RA i aprenentatges</li>
                    </ul>
                    
                    <h3>Criteris d'avaluaci√≥ del portafolis:</h3>
                    <ul>
                        <li><strong>Completesa (30%):</strong> Hi s√≥n totes les evid√®ncies?</li>
                        <li><strong>Reflexi√≥ (30%):</strong> Qualitat de la reflexi√≥ global i connexions</li>
                        <li><strong>Organitzaci√≥ (20%):</strong> Estructura clara i professional</li>
                        <li><strong>Accessibilitat (20%):</strong> El portafolis √©s usable per a tothom?</li>
                    </ul>
                    
                    <h3>Dates clau:</h3>
                    <ul>
                        <li><strong>Lliurament final:</strong> [Data a determinar]</li>
                        <li><strong>Revisi√≥ interm√®dia:</strong> [Data a determinar]</li>
                    </ul>
                    
                    <p style="margin-top:20px; font-style:italic;">Aquestes instruccions estan subjectes a possibles modificacions. Consulta sempre l'aula virtual per a la versi√≥ actualitzada.</p>
                </div>
            </div>

            <!-- Distintiu groc -->
            <div class="badge-groc">üìå Activitat ¬∑ 8 hores</div>

            <!-- OBJECTIUS I JUSTIFICACI√ì -->
            <h2 class="section-title" id="objectius">üîç Objectius i justificaci√≥</h2>
            <p>Aquesta activitat t√© com a objectiu que l'alumnat apliqui la metodologia d'investigaci√≥ d'accidents i avaluaci√≥ de riscos en contexts reals del sector el√®ctric. Dona resposta als criteris d'avaluaci√≥ 2.3, 2.4, 2.5 i 2.7 del RA2.</p>

            <!-- R√öBRICA VISIBLE (PER A L'ALUMNAT) -->
            <div class="rubrica-visual">
                <h3 style="color:#D1222B; margin-bottom:15px;">üìä R√öBRICA D'AVALUACI√ì (per a la teva orientaci√≥)</h3>
                <p>Aquesta r√∫brica mostra els criteris amb qu√® es valorar√† la teva activitat. Els nivells van de 1 (No assolit) a 4 (Excel¬∑lent).</p>
                <table>
                    <thead>
                        <tr>
                            <th>Criteri</th>
                            <th>Pes</th>
                            <th>1 - No assolit</th>
                            <th>2 - En proc√©s</th>
                            <th>3 - Assolit</th>
                            <th>4 - Excel¬∑lent</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Investigaci√≥ accident</strong></td>
                            <td>30%</td>
                            <td class="nivell-1">Incompleta, no identifica causes</td>
                            <td class="nivell-2">B√†sica, identifica causes principals</td>
                            <td class="nivell-3">Detallada amb an√†lisi causal completa</td>
                            <td class="nivell-4">Excel¬∑lent amb an√†lisi causal profund</td>
                        </tr>
                        <tr>
                            <td><strong>Aplicaci√≥ normativa</strong></td>
                            <td>30%</td>
                            <td class="nivell-1">No identifica articles vulnerats</td>
                            <td class="nivell-2">Cites gen√®riques sense concretar</td>
                            <td class="nivell-3">Articles correctes identificats</td>
                            <td class="nivell-4">Relaciona amb jurisprud√®ncia i normativa</td>
                        </tr>
                        <tr>
                            <td><strong>Avaluaci√≥ riscos</strong></td>
                            <td>20%</td>
                            <td class="nivell-1">No identifica riscos o errors greus</td>
                            <td class="nivell-2">Identifica riscos principals sense prioritzar</td>
                            <td class="nivell-3">Identifica i classifica correctament</td>
                            <td class="nivell-4">Classificaci√≥ excel¬∑lent amb mesures associades</td>
                        </tr>
                        <tr>
                            <td><strong>Qualitat documents</strong></td>
                            <td>10%</td>
                            <td class="nivell-1">Desestructurat, incomplet, errors greus</td>
                            <td class="nivell-2">Funcional per√≤ millorable</td>
                            <td class="nivell-3">Clar i ben organitzat</td>
                            <td class="nivell-4">Professional, reflexiu, amb aportacions personals</td>
                        </tr>
                    </tbody>
                </table>
                <p style="margin-top:10px; font-style:italic;">Aquesta r√∫brica √©s orientativa. El professor la utilitzar√† per a la qualificaci√≥ final.</p>
            </div>

            <!-- ENLLA√áOS D'INTER√àS -->
            <div class="info-links">
                <p><strong>üìö Enlla√ßos d'inter√®s per a l'activitat:</strong></p>
                <div>
                    <a href="https://dizquie4-sys.github.io/CURSO-CDD/fp-trs-ipo-i-u2-pdfindex.pdf" target="_blank" class="enllac-normativa">üìñ Llibre: T√®cnic b√†sic en PRL (IOC)</a>
                    <a href="https://www.boe.es/buscar/act.php?id=BOE-A-1995-24292" target="_blank" class="enllac-normativa">Llei 31/1995 (LPRL)</a>
                    <a href="https://www.boe.es/buscar/act.php?id=BOE-A-2002-18099" target="_blank" class="enllac-normativa">REBT (RD 842/2002)</a>
                    <a href="https://www.boe.es/buscar/act.php?id=BOE-A-2007-15820" target="_blank" class="enllac-normativa">RITE (RD 1027/2007)</a>
                </div>
                <div style="margin-top:10px;">
                    <p><strong>‚ö†Ô∏è Informaci√≥ t√®cnica sobre riscos (NTP - INSST):</strong></p>
                    <a href="https://www.insst.es/documentacion/colecciones-tecnicas/ntp-notas-tecnicas-de-prevencion/11-serie-ntp-numeros-366-a-400-ano-1996/ntp-391-herramientas-manuales-i-condiciones-generales-de-seguridad" target="_blank" class="enllac-ntp">Riscos mec√†nics (NTP 391)</a>
                    <a href="https://www.insst.es/normativa/seguridad-en-el-trabajo/trabajo-con-riesgo-electrico/listado-de-ntp" target="_blank" class="enllac-ntp">Riscos el√®ctrics (llistat NTP)</a>
                    <a href="https://www.insst.es/documentacion/colecciones-tecnicas/ntp-notas-tecnicas-de-prevencion/11-serie-ntp-numeros-366-a-400-ano-1996/ntp-387-evaluacion-de-las-condiciones-de-trabajo-metodo-del-analisis-ergonomico-del-puesto-de-trabajo" target="_blank" class="enllac-ntp">Riscos ergon√≤mics (NTP 387)</a>
                    <a href="https://www.insst.es/documentacion/material-tecnico/preguntas-tecnicas-frecuentes-gestion-prl/riesgos-ergonomicos/factores-ambientales" target="_blank" class="enllac-ntp">Riscos ambientals (INSST)</a>
                    <a href="https://www.insst.es/documentacion/colecciones-tecnicas/ntp-notas-tecnicas-de-prevencion/9-serie-ntp-numeros-296-a-330-ano-1994/ntp-322-valoracion-del-riesgo-de-estres-termico-indice-wbgt" target="_blank" class="enllac-ntp">Riscos t√®rmics (NTP 322)</a>
                </div>
            </div>

            <!-- METODOLOGIA I DESENVOLUPAMENT -->
            <h2 class="section-title" id="metodologia">üß≠ Metodologia i desenvolupament</h2>
            
            <!-- FASE 1 -->
            <div class="info-box">
                <h3>üîå Fase 1 ¬∑ Investigaci√≥ d'un accident el√®ctric simulat (4 hores)</h3>
                <p><strong>Cas pr√†ctic:</strong> "Un treballador d'una empresa instal¬∑ladora pateix una desc√†rrega el√®ctrica mentre realitza tasques de manteniment en un quadre de comandament sense verificar pr√®viament l'abs√®ncia de tensi√≥. L'accident provoca cremades de primer grau i baixa laboral de 15 dies."</p>
                <p><strong>Tasques (consulta el <a href="https://dizquie4-sys.github.io/CURSO-CDD/fp-trs-ipo-i-u2-pdfindex.pdf#page=23" target="_blank">llibre digital (p√†g. 23-27)</a> per a danys a la salut, i <a href="https://dizquie4-sys.github.io/CURSO-CDD/fp-trs-ipo-i-u2-pdfindex.pdf#page=31" target="_blank">p√†g. 31-35</a> per a drets i deures):</strong></p>
                <ol>
                    <li>Identificar els incompliments de l'empresa i del treballador.</li>
                    <li>Determinar els articles de la <a href="https://www.boe.es/buscar/act.php?id=BOE-A-1995-24292" target="_blank">LPRL</a>, del <a href="https://www.boe.es/buscar/act.php?id=BOE-A-2002-18099" target="_blank">REBT</a> i, si escau, del <a href="https://www.boe.es/buscar/act.php?id=BOE-A-2007-15820" target="_blank">RITE</a> vulnerats.</li>
                    <li>Proposar un pla d'intervenci√≥ que inclogui mesures t√®cniques (bloqueig, senyalitzaci√≥, verificaci√≥ d'abs√®ncia de tensi√≥) i formatives.</li>
                    <li><strong>Redactar un informe d'investigaci√≥ seguint el model normalitzat.</strong></li>
                </ol>

                <!-- MODEL D'INFORME -->
                <div class="model-visual">
                    <p><strong>üìÑ Model normalitzat d'informe d'investigaci√≥ d'accidents (INSST):</strong></p>
                    <p>Descarrega la plantilla oficial de l'INSST:</p>
                    <a href="https://www.insst.es/documents/94886/455702/prl_pyme_27.pdf/71fc2181-43cb-48cb-810f-5469fedbd4a5" target="_blank" class="plantilla-link">üì• Descarregar model INSST</a>
                    
                    <p style="margin-top:15px;"><strong>Exemple visual de l'informe:</strong></p>
                    <div style="background:#f9f9f9; padding:10px; border-radius:5px;">
                        <p><strong>INFORME D'INVESTIGACI√ì D'ACCIDENT</strong></p>
                        <p><strong>Empresa:</strong> Instal¬∑lacions El√®ctriques SL<br>
                        <strong>Data accident:</strong> 15/02/2026<br>
                        <strong>Lloc:</strong> Quadre de comandament zona B<br>
                        <strong>Treballador afectat:</strong> J.G. (electricista, 38 anys)<br>
                        <strong>Descripci√≥:</strong> En realitzar tasques de manteniment sense verificar abs√®ncia de tensi√≥...<br>
                        <strong>Causes immediates:</strong> No bloqueig, no verificaci√≥<br>
                        <strong>Causes b√†siques:</strong> Manca de procediment, formaci√≥ insuficient<br>
                        <strong>Mesures correctores:</strong> Implementar protocol de 5 regles d'or, formaci√≥ espec√≠fica</p>
                    </div>
                </div>
            </div>

            <!-- FASE 2 -->
            <div class="info-box">
                <h3>‚öôÔ∏è Fase 2 ¬∑ Avaluaci√≥ de riscos en un taller d'instal¬∑lacions el√®ctriques i t√®rmiques (4 hores)</h3>
                <p><strong>Pl√†nol i descripci√≥ del taller (consulta <a href="https://dizquie4-sys.github.io/CURSO-CDD/fp-trs-ipo-i-u2-pdfindex.pdf#page=40" target="_blank">llibre digital (p√†g. 40-43)</a> per a participaci√≥ i recursos preventius):</strong></p>
                <div style="background: #f0f7ff; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                    <p><strong>Taller "Electro-Serveis"</strong> - Superf√≠cie 120m¬≤. Distribuci√≥:</p>
                    <ul>
                        <li>Zona A (40m¬≤): Muntatge de quadres el√®ctrics. Pres√®ncia de cables, eines manuals, bancs de treball.</li>
                        <li>Zona B (30m¬≤): Proves i simulaci√≥. Equips de mesura, fonts d'alimentaci√≥.</li>
                        <li>Zona C (30m¬≤): Manteniment de sistemes t√®rmics. Escales, eines el√®ctriques.</li>
                        <li>Zona D (20m¬≤): Emmagatzematge de materials.</li>
                    </ul>
                    <p><em>Descripci√≥: Empresa amb 8 treballadors, dedicada al muntatge i manteniment d'instal¬∑lacions el√®ctriques, automatismes i sistemes t√®rmics.</em></p>
                </div>

                <p><strong>Tasques (identifica riscos consultant les NTP de l'INSST):</strong></p>
                <ol>
                    <li><strong>Identificar els riscos presents en cada √†rea:</strong> 
                        <a href="https://www.insst.es/documentacion/colecciones-tecnicas/ntp-notas-tecnicas-de-prevencion/11-serie-ntp-numeros-366-a-400-ano-1996/ntp-391-herramientas-manuales-i-condiciones-generales-de-seguridad" target="_blank" class="enllac-ntp">mec√†nics (NTP 391)</a>, 
                        <a href="https://www.insst.es/normativa/seguridad-en-el-trabajo/trabajo-con-riesgo-electrico/listado-de-ntp" target="_blank" class="enllac-ntp">el√®ctrics (llistat NTP)</a>, 
                        <a href="https://www.insst.es/documentacion/colecciones-tecnicas/ntp-notas-tecnicas-de-prevencion/11-serie-ntp-numeros-366-a-400-ano-1996/ntp-387-evaluacion-de-las-condiciones-de-trabajo-metodo-del-analisis-ergonomico-del-puesto-de-trabajo" target="_blank" class="enllac-ntp">ergon√≤mics (NTP 387)</a>, 
                        <a href="https://www.insst.es/documentacion/material-tecnico/preguntas-tecnicas-frecuentes-gestion-prl/riesgos-ergonomicos/factores-ambientales" target="_blank" class="enllac-ntp">ambientals (INSST)</a>, 
                        <a href="https://www.insst.es/documentacion/colecciones-tecnicas/ntp-notas-tecnicas-de-prevencion/9-serie-ntp-numeros-296-a-330-ano-1994/ntp-322-valoracion-del-riesgo-de-estres-termico-indice-wbgt" target="_blank" class="enllac-ntp">t√®rmics (NTP 322)</a>.
                    </li>
                    <li>Classificar els riscos per ordre de prioritat.</li>
                    <li>Proposar mesures preventives i protectores concretes, especificant la normativa d'aplicaci√≥ (LPRL, REBT, RITE).</li>
                    <li><strong>Emplenar un model simplificat d'avaluaci√≥ de riscos.</strong></li>
                </ol>

                <!-- MODEL SIMPLIFICAT D'AVALUACI√ì -->
                <div class="pla-simplificat">
                    <p><strong>üìã Model simplificat d'avaluaci√≥ de riscos (INSST - NTP 330):</strong></p>
                    <a href="https://www.insst.es/documentacion/colecciones-tecnicas/ntp-notas-tecnicas-de-prevencion/9-serie-ntp-numeros-296-a-330-ano-1994/ntp-330-sistema-simplificado-de-evaluacion-de-riesgos-de-accidente-1993" target="_blank" class="plantilla-link">üì• Descarregar model simplificat INSST</a>
                    
                    <p style="margin-top:15px;"><strong>Exemple visual de la taula d'avaluaci√≥:</strong></p>
                    <table style="width:100%; border-collapse: collapse; background:white; border:1px solid #ddd;">
                        <tr style="background:#D1222B; color:white;">
                            <th style="padding:8px;">√Ärea</th>
                            <th style="padding:8px;">Risc identificat</th>
                            <th style="padding:8px;">Probabilitat (1-3)</th>
                            <th style="padding:8px;">Severitat (1-3)</th>
                            <th style="padding:8px;">Valoraci√≥</th>
                            <th style="padding:8px;">Mesures preventives</th>
                        </tr>
                        <tr>
                            <td>Zona A</td>
                            <td>Contacte el√®ctric</td>
                            <td>2</td>
                            <td>3</td>
                            <td>6 (Important)</td>
                            <td>Verificaci√≥ abs√®ncia tensi√≥, EPI</td>
                        </tr>
                        <tr>
                            <td>Zona C</td>
                            <td>Caiguda d'altura</td>
                            <td>2</td>
                            <td>3</td>
                            <td>6 (Important)</td>
                            <td>Baranes, √∫s d'arn√®s</td>
                        </tr>
                        <tr>
                            <td>Zona A</td>
                            <td>Sobreesfor√ßos</td>
                            <td>3</td>
                            <td>2</td>
                            <td>6 (Important)</td>
                            <td>Formaci√≥, eines auxiliars</td>
                        </tr>
                    </table>
                </div>
            </div>

            <!-- FASE 3: Producte i evid√®ncia -->
            <div class="info-box" style="background: #e6f2ff; border-left-color: #D1222B;">
                <h3 style="color:#D1222B;">üì¶ Fase 3 ¬∑ Producte i evid√®ncia d'aprenentatge</h3>
                <p>En finalitzar l'activitat, haur√†s de generar:</p>
                <ul>
                    <li><strong>Informe d'investigaci√≥ d'accident (PDF).</strong> S'incorpora al portafolis.</li>
                    <li><strong>Avaluaci√≥ de riscos del taller simulat (PDF o plantilla emplenada).</strong> S'incorpora al portafolis.</li>
                </ul>
                <p style="margin-top:10px;">‚úÖ Aquests documents seran les evid√®ncies principals d'aprenentatge.</p>
            </div>

            <hr>

            <!-- FORMULARI PER A L'ESTUDIANT -->
            <h2 class="section-title">üìã Dades de l'estudiant</h2>
            <label class="required" for="nom">Nom i cognoms</label>
            <input type="text" id="nom" placeholder="Ex: Maria Garcia" aria-required="true">
            
            <label class="required" for="grup">Grup</label>
            <input type="text" id="grup" placeholder="Ex: Grup A" aria-required="true">
            
            <label class="required" for="enllac">Enlla√ß als documents de l'activitat (Drive, GitHub...)</label>
            <input type="url" id="enllac" placeholder="https://..." aria-required="true">
            
            <label for="autovaloracio">Autovaloraci√≥ de l'activitat (dificultat, utilitat...)</label>
            <select id="autovaloracio">
                <option value="">-- Selecciona --</option>
                <option value="1">1 - Molt dif√≠cil</option>
                <option value="2">2 - Una mica dif√≠cil</option>
                <option value="3">3 - Neutral</option>
                <option value="4">4 - F√†cil</option>
                <option value="5">5 - Molt f√†cil i √∫til</option>
            </select>

            <!-- BOT√ì DEL BLOC DESPLEGABLE -->
            <div style="text-align:center; margin:20px 0; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                <button class="btn btn-primary" id="toggleBlocInformeBtn" aria-expanded="false">
                    üß† Informe final de l'estudiant
                </button>
            </div>

            <!-- =========================================== -->
            <!-- BLOC INFORME FINAL -->
            <!-- =========================================== -->
            <div class="bloc-container" id="blocInformeContainer" aria-hidden="true">
                <h3 class="bloc-title">üß† Informe final de l'estudiant</h3>
                <p>Respon a les seg√ºents preguntes. Les respostes s'inclouran a l'informe final.</p>
                
                <label class="required" for="pregunta1">1. Quins incompliments de l'empresa i del treballador has identificat? (consulta <a href="https://dizquie4-sys.github.io/CURSO-CDD/fp-trs-ipo-i-u2-pdfindex.pdf#page=23" target="_blank">llibre p√†g. 23-27</a>)</label>
                <textarea id="pregunta1" required aria-required="true" rows="3"></textarea>
                
                <label class="required" for="pregunta2">2. Quins articles de la LPRL, REBT i RITE s'han vulnerat? (consulta <a href="https://dizquie4-sys.github.io/CURSO-CDD/fp-trs-ipo-i-u2-pdfindex.pdf#page=31" target="_blank">llibre p√†g. 31-35</a>)</label>
                <textarea id="pregunta2" required aria-required="true" rows="3"></textarea>
                
                <label class="required" for="pregunta3">3. Quin pla d'intervenci√≥ proposes (mesures t√®cniques i formatives)?</label>
                <textarea id="pregunta3" required aria-required="true" rows="3"></textarea>
                
                <label class="required" for="pregunta4">4. Quins riscos has identificat al taller? Classifica'ls per prioritat. (consulta NTP de l'INSST)</label>
                <textarea id="pregunta4" required aria-required="true" rows="3"></textarea>
                
                <label class="required" for="pregunta5">5. Quines mesures preventives i protectores proposes per a cada risc? (consulta <a href="https://dizquie4-sys.github.io/CURSO-CDD/fp-trs-ipo-i-u2-pdfindex.pdf#page=40" target="_blank">llibre p√†g. 40-43</a>)</label>
                <textarea id="pregunta5" required aria-required="true" rows="3"></textarea>
                
                <!-- NOVA PREGUNTA 6 -->
                <label class="required" for="aprenentatge">6. Explica qu√® has apr√®s en aquesta activitat (coneixements, habilitats, dificultats superades...)</label>
                <textarea id="aprenentatge" required aria-required="true" rows="4"></textarea>
            </div>

            <!-- Botons d'autoavaluaci√≥ (les de sempre) -->
            <div style="text-align:center; margin:20px 0; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                <button class="btn btn-primary" id="toggleAutoavaluacioBtn" aria-expanded="false">
                    üìù Autoavaluaci√≥ pr√®via (10 preguntes)
                </button>
                <button class="btn btn-primary" id="toggleExamenBtn" aria-expanded="false">
                    üìù AUTOAVALUACI√ì PER A L'EXAMEN FINAL (20 preguntes)
                </button>
            </div>

            <!-- AUTOAVALUACI√ì 10 PREGUNTES -->
            <div class="autoavaluacio-container" id="autoavaluacioContainer" aria-hidden="true">
                <h3 style="color:#D1222B;">Autoavaluaci√≥ (10 preguntes)</h3>
                <p>Respon aquestes 10 preguntes per comprovar els teus coneixements sobre prevenci√≥ de riscos laborals (basat en el <a href="https://dizquie4-sys.github.io/CURSO-CDD/fp-trs-ipo-i-u2-pdfindex.pdf" target="_blank">llibre digital</a>).</p>

                <div class="quiz-item">
                    <div class="quiz-question">1. Quina llei √©s la norma marc en prevenci√≥ de riscos laborals? (<a href="https://dizquie4-sys.github.io/CURSO-CDD/fp-trs-ipo-i-u2-pdfindex.pdf#page=31" target="_blank">p√†g. 31</a>)</div>
                    <div class="quiz-options">
                        <label><input type="radio" name="quiz1" value="a"> Llei 31/1995 (LPRL)</label>
                        <label><input type="radio" name="quiz1" value="b"> RD 842/2002 (REBT)</label>
                        <label><input type="radio" name="quiz1" value="c"> RD 1027/2007 (RITE)</label>
                    </div>
                </div>
                <div class="quiz-item">
                    <div class="quiz-question">2. Qu√® regula el REBT? (<a href="https://dizquie4-sys.github.io/CURSO-CDD/fp-trs-ipo-i-u2-pdfindex.pdf#page=31" target="_blank">p√†g. 31</a>)</div>
                    <div class="quiz-options">
                        <label><input type="radio" name="quiz2" value="a"> La prevenci√≥ de riscos laborals</label>
                        <label><input type="radio" name="quiz2" value="b"> Les instal¬∑lacions el√®ctriques de baixa tensi√≥</label>
                        <label><input type="radio" name="quiz2" value="c"> Les instal¬∑lacions t√®rmiques</label>
                    </div>
                </div>
                <div class="quiz-item">
                    <div class="quiz-question">3. Quin √©s l'objectiu principal d'una investigaci√≥ d'accidents? (<a href="https://dizquie4-sys.github.io/CURSO-CDD/fp-trs-ipo-i-u2-pdfindex.pdf#page=23" target="_blank">p√†g. 23-27</a>)</div>
                    <div class="quiz-options">
                        <label><input type="radio" name="quiz3" value="a"> Trobar un culpable</label>
                        <label><input type="radio" name="quiz3" value="b"> Identificar causes per evitar futurs accidents</label>
                        <label><input type="radio" name="quiz3" value="c"> Complir un tr√†mit administratiu</label>
                    </div>
                </div>
                <div class="quiz-item">
                    <div class="quiz-question">4. Qu√® √©s un risc laboral? (<a href="https://dizquie4-sys.github.io/CURSO-CDD/fp-trs-ipo-i-u2-pdfindex.pdf#page=15" target="_blank">p√†g. 15</a>)</div>
                    <div class="quiz-options">
                        <label><input type="radio" name="quiz4" value="a"> Un accident que ja ha passat</label>
                        <label><input type="radio" name="quiz4" value="b"> La possibilitat que un treballador pateixi un dany</label>
                        <label><input type="radio" name="quiz4" value="c"> Una malaltia professional</label>
                    </div>
                </div>
                <div class="quiz-item">
                    <div class="quiz-question">5. Quins s√≥n riscos espec√≠fics del sector el√®ctric? (<a href="https://dizquie4-sys.github.io/CURSO-CDD/fp-trs-ipo-i-u2-pdfindex.pdf#page=15" target="_blank">p√†g. 15-17</a>)</div>
                    <div class="quiz-options">
                        <label><input type="radio" name="quiz5" value="a"> Riscos psicosocials</label>
                        <label><input type="radio" name="quiz5" value="b"> Contactes el√®ctrics, treballs en altura, atrapaments</label>
                        <label><input type="radio" name="quiz5" value="c"> Riscos biol√≤gics</label>
                    </div>
                </div>
                <div class="quiz-item">
                    <div class="quiz-question">6. Qu√® s'ha de fer abans de treballar en un quadre el√®ctric? (<a href="https://dizquie4-sys.github.io/CURSO-CDD/fp-trs-ipo-i-u2-pdfindex.pdf#page=17" target="_blank">p√†g. 17-18</a>)</div>
                    <div class="quiz-options">
                        <label><input type="radio" name="quiz6" value="a"> Treballar amb tensi√≥</label>
                        <label><input type="radio" name="quiz6" value="b"> Verificar abs√®ncia de tensi√≥</label>
                        <label><input type="radio" name="quiz6" value="c"> No cal fer res especial</label>
                    </div>
                </div>
                <div class="quiz-item">
                    <div class="quiz-question">7. Qu√® √©s una mesura preventiva? (<a href="https://dizquie4-sys.github.io/CURSO-CDD/fp-trs-ipo-i-u2-pdfindex.pdf#page=17" target="_blank">p√†g. 17</a>)</div>
                    <div class="quiz-options">
                        <label><input type="radio" name="quiz7" value="a"> Actuaci√≥ despr√©s d'un accident</label>
                        <label><input type="radio" name="quiz7" value="b"> Acci√≥ per eliminar o reduir riscos</label>
                        <label><input type="radio" name="quiz7" value="c"> Un equip de protecci√≥ individual</label>
                    </div>
                </div>
                <div class="quiz-item">
                    <div class="quiz-question">8. Quina norma regula les instal¬∑lacions t√®rmiques? (<a href="https://dizquie4-sys.github.io/CURSO-CDD/fp-trs-ipo-i-u2-pdfindex.pdf#page=31" target="_blank">p√†g. 31</a>)</div>
                    <div class="quiz-options">
                        <label><input type="radio" name="quiz8" value="a"> LPRL</label>
                        <label><input type="radio" name="quiz8" value="b"> REBT</label>
                        <label><input type="radio" name="quiz8" value="c"> RITE</label>
                    </div>
                </div>
                <div class="quiz-item">
                    <div class="quiz-question">9. Quina prioritat tenen les mesures de protecci√≥? (<a href="https://dizquie4-sys.github.io/CURSO-CDD/fp-trs-ipo-i-u2-pdfindex.pdf#page=17" target="_blank">p√†g. 17-18</a>)</div>
                    <div class="quiz-options">
                        <label><input type="radio" name="quiz9" value="a"> Protecci√≥ individual abans que col¬∑lectiva</label>
                        <label><input type="radio" name="quiz9" value="b"> Protecci√≥ col¬∑lectiva abans que individual</label>
                        <label><input type="radio" name="quiz9" value="c"> S√≥n igual d'importants</label>
                    </div>
                </div>
                <div class="quiz-item">
                    <div class="quiz-question">10. Qu√® has de fer amb els informes d'aquesta activitat? (p√†g. final)</div>
                    <div class="quiz-options">
                        <label><input type="radio" name="quiz10" value="a"> Guardar-los a l'ordinador</label>
                        <label><input type="radio" name="quiz10" value="b"> Penjar-los a Moodle i incorporar-los al portafolis</label>
                        <label><input type="radio" name="quiz10" value="c"> Enviar-los per correu al professor</label>
                    </div>
                </div>

                <div style="display:flex; gap:15px; flex-wrap:wrap; justify-content:center; margin-bottom:20px;">
                    <button class="btn btn-primary" id="checkQuizBtn">‚úÖ Comprova respostes</button>
                    <button class="btn btn-outline" id="resetQuizBtn">‚Üª Tornar a comen√ßar</button>
                    <button class="btn btn-close" id="closeQuizBtn">‚úñ Tancar</button>
                </div>
                <div id="quizFeedback" class="feedback-quiz"></div>
            </div>

            <!-- AUTOAVALUACI√ì 20 PREGUNTES -->
            <div class="examen-container" id="examenContainer" aria-hidden="true">
                <h2 style="color:#D1222B; margin-bottom:20px;">üìù AUTOAVALUACI√ì PER A L'EXAMEN FINAL (20 preguntes)</h2>
                <p style="margin-bottom:20px;">Aquestes preguntes s√≥n representatives del que trobar√†s a l'examen final. 
                Has d'obtenir un m√≠nim del <strong>70% (14/20)</strong> per considerar que has assolit els continguts.</p>

                <div id="examen-preguntes"></div>

                <div style="text-align:center; margin:20px 0;">
                    <button class="btn btn-primary" id="comprovarExamenBtn">‚úÖ Comprova respostes</button>
                    <button class="btn btn-secondary" id="reiniciarExamenBtn">‚Üª Reiniciar examen</button>
                    <button class="btn btn-close" id="closeExamenBtn">‚úñ Tancar</button>
                </div>

                <div id="examen-resultat" class="examen-resultat"></div>
                <div id="examen-feedback-global" style="margin-top:15px;"></div>
            </div>

            <!-- Botons d'acci√≥ finals -->
            <div class="buttons">
                <button class="btn btn-danger" id="resetBtn">üóëÔ∏è Esborrar tot</button>
                <button class="btn btn-primary" id="submitBtn">‚úÖ Preparar per enviar</button>
            </div>

            <!-- √Ärea de resultats -->
            <div class="results-area" id="resultsArea">
                <h2 style="color:#D1222B;">üìà Dades per al professor</h2>
                <p>Prem "Exporta JSON" per generar un fitxer amb les teves respostes.</p>
                <div class="buttons">
                    <button class="btn btn-primary" id="pdfBtn">üì• Descarregar PDF (per a Moodle)</button>
                    <button class="btn btn-success" id="jsonBtn">üìä Exportar JSON</button>
                    <button class="btn btn-primary" id="copyJsonBtn">üìã Copiar JSON al portapapers</button>
                </div>
                <div style="text-align: center; margin-top: 10px;">
                    <button class="btn btn-secondary" id="explicacioJsonBtn">‚ùì Com enviar (explicaci√≥)</button>
                </div>
                <div id="jsonContainer" class="json-container" style="display:none;"></div>
                <div id="copyStatus" style="display:none; background:#d4edda; padding:10px; border-radius:10px; margin-top:10px;">‚úÖ JSON copiat!</div>
            </div>

            <!-- Recordatori final millorat -->
            <div style="background: #e6f2ff; border-radius: 20px; padding: 20px; margin: 30px 0; border-left: 5px solid #D1222B;">
                <span style="font-size:1.3rem; font-weight:bold;">üìÅ LLIURAMENT DE L'ACTIVITAT</span>
                
                <p style="margin-top:15px;">Abans de tancar aquesta p√†gina, assegura't que has completat els seg√ºents passos:</p>
                
                <div style="background: white; border-radius: 15px; padding: 20px; margin: 15px 0; border: 2px solid #D1222B;">
                    
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px; flex-wrap: wrap;">
                        <div style="background: #D1222B; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.3rem;">1</div>
                        <div style="flex: 1;">
                            <strong style="color: #D1222B;">üì• DESA EL TEU TREBALL (OPCIONAL)</strong>
                            <p style="margin-top:5px;">Totes les respostes es guarden autom√†ticament al teu navegador. Pots tancar i tornar-hi m√©s tard sense perdre res.</p>
                        </div>
                    </div>
                    
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px; flex-wrap: wrap;">
                        <div style="background: #D1222B; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.3rem;">2</div>
                        <div style="flex: 1;">
                            <strong style="color: #D1222B;">üì§ EXPORTA EL FITXER JSON</strong>
                            <p style="margin-top:5px;">Prem el bot√≥ <strong>"üìä Exportar JSON"</strong> (a la secci√≥ de resultats). Es generar√† un fitxer amb les teves respostes que es desar√† a la carpeta <strong>DESCARREGUES</strong>.</p>
                        </div>
                    </div>
                    
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px; flex-wrap: wrap;">
                        <div style="background: #D1222B; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.3rem;">3</div>
                        <div style="flex: 1;">
                            <strong style="color: #D1222B;">üìé PENJA A MOODLE</strong>
                            <p style="margin-top:5px;">Puja a Moodle els seg√ºents documents:</p>
                            <ul style="margin-left: 20px; margin-top: 5px;">
                                <li><strong>üìÅ Fitxer JSON</strong> (obligatori - cont√© totes les respostes)</li>
                                <li><strong>üìÑ Informe d'investigaci√≥ d'accident</strong> (PDF)</li>
                                <li><strong>üìä Avaluaci√≥ de riscos</strong> (PDF o plantilla)</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                        <div style="background: #D1222B; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.3rem;">4</div>
                        <div style="flex: 1;">
                            <strong style="color: #D1222B;">üìÅ INCORPORA AL PORTAFOLIS</strong>
                            <p style="margin-top:5px;">Guarda una c√≤pia de tots els documents al teu <strong>portafolis digital professional</strong>.</p>
                        </div>
                    </div>
                    
                </div>
                
                <div style="background: #FFC72C; border-radius: 15px; padding: 15px; margin-top: 15px; border: 2px solid #D1222B; text-align: center;">
                    <p style="font-weight:bold; color:#D1222B; font-size: 1.1rem;">‚ö†Ô∏è IMPORTANT: El fitxer JSON √©s l'√∫nica evid√®ncia que cont√© TOTES les teves respostes.</p>
                    <p style="margin-top:5px;">Sense aquest fitxer, el professor no podr√† avaluar correctament la teva activitat.</p>
                </div>
            </div>
            <hr>
        </div>
        <div class="footer">Diego Izquierdo ¬∑ FOL ¬∑ IOC ¬∑ Contingut accessible ‚ôø</div>
    </div>

    <script>
        // ===========================================
        // FUNCIONS DEL MODAL
        // ===========================================
        var modalPortafolis = document.getElementById('modalPortafolis');
        var btnPortafolis = document.getElementById('modalPortafolisBtn');
        var spanPortafolis = document.getElementsByClassName('close-modal')[0];
        
        btnPortafolis.onclick = function() {
            modalPortafolis.style.display = 'block';
        }
        
        spanPortafolis.onclick = function() {
            modalPortafolis.style.display = 'none';
        }
        
        window.onclick = function(event) {
            if (event.target == modalPortafolis) {
                modalPortafolis.style.display = 'none';
            }
        }

        // ===========================================
        // PDF d'instruccions amb r√∫brica completa
        // ===========================================
        document.getElementById('pdfInstruccionsBtn').addEventListener('click', function() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // T√≠tol
            doc.setFontSize(20);
            doc.setTextColor(209,34,43);
            doc.text('RA2 ¬∑ Investigaci√≥ d\'accidents + Avaluaci√≥ de riscos', 20, 20);
            
            // Descripci√≥
            doc.setFontSize(12);
            doc.setTextColor(0,0,0);
            doc.text('DESCRIPCI√ì', 20, 35);
            doc.setFontSize(10);
            doc.text('Activitat de 8 hores per investigar accidents i avaluar riscos en el sector el√®ctric', 20, 45);
            
            // Objectius
            doc.setFontSize(12);
            doc.text('OBJECTIUS', 20, 60);
            doc.setFontSize(10);
            doc.text('‚Ä¢ Investigar un accident el√®ctric simulat', 25, 70);
            doc.text('‚Ä¢ Identificar incompliments normatius', 25, 77);
            doc.text('‚Ä¢ Avaluar riscos en un taller', 25, 84);
            
            // Metodologia
            doc.setFontSize(12);
            doc.text('METODOLOGIA', 20, 99);
            doc.setFontSize(10);
            doc.text('Fase 1 (4h): Investigaci√≥ d\'accident el√®ctric simulat', 25, 109);
            doc.text('Fase 2 (4h): Avaluaci√≥ de riscos en taller', 25, 116);
            doc.text('Fase 3: Lliurament de documents a Moodle + portafolis', 25, 123);
            
            // PREGUNTES DE L'ACTIVITAT (NOU)
            doc.setFontSize(12);
            doc.text('PREGUNTES DE L\'ACTIVITAT', 20, 143);
            doc.setFontSize(10);
            
            let y = 153;
            const preguntes = [
                'INFORME FINAL:',
                '1. Quins incompliments de l\'empresa i del treballador has identificat?',
                '2. Quins articles de la LPRL, REBT i RITE s\'han vulnerat?',
                '3. Quin pla d\'intervenci√≥ proposes?',
                '4. Quins riscos has identificat al taller? Classifica\'ls per prioritat.',
                '5. Quines mesures preventives i protectores proposes per a cada risc?',
                '6. Explica qu√® has apr√®s en aquesta activitat.'
            ];
            
            preguntes.forEach(p => {
                if (p === '') {
                    y += 3;
                } else {
                    doc.text(p, 25, y);
                    y += 6;
                }
            });
            
            // Escala de valoraci√≥
            doc.setFontSize(12);
            doc.text('ESCALA DE VALORACI√ì (1‚Äì4)', 20, y+10);
            doc.setFontSize(10);
            doc.text('1 - No assolit', 25, y+20);
            doc.text('2 - En la direcci√≥ adequada', 25, y+27);
            doc.text('3 - Assolit', 25, y+34);
            doc.text('4 - Excel¬∑lent', 25, y+41);
            
            // R√öBRICA COMPLETA
            doc.addPage();
            doc.setFontSize(12);
            doc.text('R√öBRICA D\'AVALUACI√ì', 20, 20);
            
            doc.setFontSize(8);
            doc.text('Criteri', 20, 30);
            doc.text('Excel¬∑lent (4)', 50, 30);
            doc.text('Assolit (3)', 85, 30);
            doc.text('En proc√©s (2)', 120, 30);
            doc.text('No assolit (1)', 155, 30);
            doc.text('Pes', 185, 30);
            
            doc.line(20, 32, 195, 32);
            
            // Criteri 1 - Investigaci√≥
            doc.text('C1: Investigaci√≥', 20, 42);
            doc.text('An√†lisi causal', 50, 42);
            doc.text('profunda', 50, 47);
            doc.text('Detallada', 85, 42);
            doc.text('completa', 85, 47);
            doc.text('B√†sica,', 120, 42);
            doc.text('causes', 120, 47);
            doc.text('Incompleta,', 155, 42);
            doc.text('sense causes', 155, 47);
            doc.text('30%', 185, 45);
            
            // Criteri 2 - Normativa
            doc.text('C2: Normativa', 20, 57);
            doc.text('Relaciona amb', 50, 57);
            doc.text('jurisprud.', 50, 62);
            doc.text('Articles', 85, 57);
            doc.text('correctes', 85, 62);
            doc.text('Cites', 120, 57);
            doc.text('gen√®riques', 120, 62);
            doc.text('No', 155, 57);
            doc.text('identifica', 155, 62);
            doc.text('30%', 185, 60);
            
            doc.addPage();
            doc.setFontSize(12);
            doc.text('R√öBRICA D\'AVALUACI√ì (p√†gina 2/2)', 20, 20);
            
            doc.setFontSize(8);
            doc.text('Criteri', 20, 30);
            doc.text('Excel¬∑lent (4)', 50, 30);
            doc.text('Assolit (3)', 85, 30);
            doc.text('En proc√©s (2)', 120, 30);
            doc.text('No assolit (1)', 155, 30);
            doc.text('Pes', 185, 30);
            
            doc.line(20, 32, 195, 32);
            
            // Criteri 3 - Riscos
            doc.text('C3: Riscos', 20, 42);
            doc.text('Classificaci√≥', 50, 42);
            doc.text('excel¬∑lent', 50, 47);
            doc.text('Identifica i', 85, 42);
            doc.text('classifica', 85, 47);
            doc.text('Riscos', 120, 42);
            doc.text('principals', 120, 47);
            doc.text('Errors', 155, 42);
            doc.text('greus', 155, 47);
            doc.text('20%', 185, 45);
            
            // Criteri 4 - Qualitat
            doc.text('C4: Qualitat', 20, 57);
            doc.text('Professional,', 50, 57);
            doc.text('reflexiu', 50, 62);
            doc.text('Clar i', 85, 57);
            doc.text('organitzat', 85, 62);
            doc.text('Funcional,', 120, 57);
            doc.text('millorable', 120, 62);
            doc.text('Desestruct,', 155, 57);
            doc.text('incomplet', 155, 62);
            doc.text('10%', 185, 60);
            
            doc.save('RA2_instruccions_completes.pdf');
        });

        // ===========================================
        // GUARDAT AUTOM√ÄTIC AMB LOCALSTORAGE (PREFIX ra2_)
        // ===========================================
        const PREFIX = 'ra2_';
        
        function carregarDadesGuardades() {
            document.querySelectorAll('input[type="text"], textarea, input[type="url"], select').forEach(camp => {
                let valorGuardat = localStorage.getItem(PREFIX + camp.id);
                if (valorGuardat) camp.value = valorGuardat;
            });
            
            document.querySelectorAll('input[type="radio"]').forEach(radio => {
                let nom = radio.name;
                let valorGuardat = localStorage.getItem(PREFIX + nom);
                if (valorGuardat === radio.value) radio.checked = true;
            });
        }
        
        function guardarCamp(camp) {
            localStorage.setItem(PREFIX + camp.id, camp.value);
        }
        
        function guardarRadio(name, value) {
            localStorage.setItem(PREFIX + name, value);
        }
        
        window.addEventListener('load', carregarDadesGuardades);
        
        document.querySelectorAll('input[type="text"], textarea, input[type="url"], select').forEach(camp => {
            camp.addEventListener('input', function() { guardarCamp(this); });
        });
        
        document.querySelectorAll('input[type="radio"]').forEach(radio => {
            radio.addEventListener('change', function() {
                guardarRadio(this.name, this.value);
            });
        });

        // ===========================================
        // MODAL D'EXPLICACI√ì JSON
        // ===========================================
        function obrirModalExplicacio() {
            document.getElementById('modalExplicacio').style.display = 'block';
        }
        
        document.getElementById('explicacioJsonBtn')?.addEventListener('click', obrirModalExplicacio);
        
        document.querySelector('.modal-explicacio-tancar').addEventListener('click', function() {
            document.getElementById('modalExplicacio').style.display = 'none';
        });
        
        document.getElementById('tancarModalBtn').addEventListener('click', function() {
            document.getElementById('modalExplicacio').style.display = 'none';
        });
        
        window.addEventListener('click', function(event) {
            let modal = document.getElementById('modalExplicacio');
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        });

        // ===========================================
        // BOT√ì FLOTANT TORNAR A DALT
        // ===========================================
        document.getElementById('tornarDaltBtn').addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });
        
        document.getElementById('tornarDaltBtn').addEventListener('keydown', function(e) {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        });

        // ===========================================
        // Toggle Bloc Informe Final
        // ===========================================
        document.getElementById('toggleBlocInformeBtn').addEventListener('click', function() {
            let container = document.getElementById('blocInformeContainer');
            let isHidden = container.style.display === 'none' || container.style.display === '';
            container.style.display = isHidden ? 'block' : 'none';
            this.setAttribute('aria-expanded', isHidden);
            container.setAttribute('aria-hidden', !isHidden);
        });

        // ===========================================
        // Toggle autoavaluaci√≥ 10 preguntes
        // ===========================================
        document.getElementById('toggleAutoavaluacioBtn').addEventListener('click', function() {
            let container = document.getElementById('autoavaluacioContainer');
            let isHidden = container.style.display === 'none' || container.style.display === '';
            container.style.display = isHidden ? 'block' : 'none';
            this.setAttribute('aria-expanded', isHidden);
            container.setAttribute('aria-hidden', !isHidden);
        });

        document.getElementById('toggleExamenBtn').addEventListener('click', function() {
            let container = document.getElementById('examenContainer');
            let isHidden = container.style.display === 'none' || container.style.display === '';
            container.style.display = isHidden ? 'block' : 'none';
            this.setAttribute('aria-expanded', isHidden);
            container.setAttribute('aria-hidden', !isHidden);
        });

        document.getElementById('closeQuizBtn').addEventListener('click', function() {
            document.getElementById('autoavaluacioContainer').style.display = 'none';
            document.getElementById('toggleAutoavaluacioBtn').setAttribute('aria-expanded', 'false');
        });

        document.getElementById('closeExamenBtn').addEventListener('click', function() {
            document.getElementById('examenContainer').style.display = 'none';
            document.getElementById('toggleExamenBtn').setAttribute('aria-expanded', 'false');
        });

        // ===========================================
        // Comprova autoavaluaci√≥ 10 preguntes
        // ===========================================
        document.getElementById('checkQuizBtn').addEventListener('click', function() {
            let correctes = 0;
            
            if (document.querySelector('input[name="quiz1"]:checked')?.value === 'a') correctes++;
            if (document.querySelector('input[name="quiz2"]:checked')?.value === 'b') correctes++;
            if (document.querySelector('input[name="quiz3"]:checked')?.value === 'b') correctes++;
            if (document.querySelector('input[name="quiz4"]:checked')?.value === 'b') correctes++;
            if (document.querySelector('input[name="quiz5"]:checked')?.value === 'b') correctes++;
            if (document.querySelector('input[name="quiz6"]:checked')?.value === 'b') correctes++;
            if (document.querySelector('input[name="quiz7"]:checked')?.value === 'b') correctes++;
            if (document.querySelector('input[name="quiz8"]:checked')?.value === 'c') correctes++;
            if (document.querySelector('input[name="quiz9"]:checked')?.value === 'b') correctes++;
            if (document.querySelector('input[name="quiz10"]:checked')?.value === 'b') correctes++;

            let feedback = document.getElementById('quizFeedback');
            feedback.style.display = 'block';
            
            if (correctes === 10) {
                feedback.innerHTML = '‚úÖ Excel¬∑lent! Has respost correctament totes les preguntes.';
                feedback.style.background = '#d4edda';
                feedback.style.color = '#155724';
            } else if (correctes >= 7) {
                feedback.innerHTML = `‚úÖ Has obtingut ${correctes}/10. Molt b√©! Revisa els errors.`;
                feedback.style.background = '#fff3cd';
                feedback.style.color = '#856404';
            } else {
                feedback.innerHTML = `‚ùå Has obtingut ${correctes}/10. Torna a llegir l'activitat.`;
                feedback.style.background = '#f8d7da';
                feedback.style.color = '#721c24';
            }
        });

        document.getElementById('resetQuizBtn').addEventListener('click', function() {
            for(let i = 1; i <= 10; i++) {
                let radios = document.querySelectorAll(`input[name="quiz${i}"]`);
                radios.forEach(r => r.checked = false);
            }
            document.getElementById('quizFeedback').style.display = 'none';
        });

        // ===========================================
        // EXAMEN DE 20 PREGUNTES
        // ===========================================
        const preguntesExamen = [
            { pregunta: "1. Llei 31/1995 √©s la norma b√†sica en prevenci√≥ de riscos laborals.", tipus: "vf", correcta: "v", explicacio: "Correcte. La Llei 31/1995 √©s la Llei de Prevenci√≥ de Riscos Laborals." },
            { pregunta: "2. Quin article de la LPRL estableix el dret a la protecci√≥?", tipus: "mc", opcions: ["a) Art. 14", "b) Art. 15", "c) Art. 16"], correcta: "a", explicacio: "L'article 14 de la LPRL estableix el dret a la protecci√≥." },
            { pregunta: "3. Qu√® regula el REBT?", tipus: "mc", opcions: ["a) Instal¬∑lacions el√®ctriques", "b) Instal¬∑lacions t√®rmiques", "c) Prevenci√≥ de riscos"], correcta: "a", explicacio: "El REBT regula les instal¬∑lacions el√®ctriques." },
            { pregunta: "4. Quina NTP tracta els riscos el√®ctrics?", tipus: "mc", opcions: ["a) NTP 399", "b) NTP 387", "c) NTP 322"], correcta: "a", explicacio: "La NTP 399 tracta riscos el√®ctrics." },
            { pregunta: "5. En una investigaci√≥ d'accidents, l'objectiu principal √©s trobar un culpable.", tipus: "vf", correcta: "f", explicacio: "Fals. L'objectiu √©s identificar causes per prevenir." },
            { pregunta: "6. El per√≠ode de prova pot ser de 6 mesos per a qualsevol treballador.", tipus: "vf", correcta: "f", explicacio: "Fals. El m√†xim √©s 2 mesos per a no titulats, 6 per a titulats." },
            { pregunta: "7. Quina √©s la prioritat en mesures de protecci√≥?", tipus: "mc", opcions: ["a) Individual abans que col¬∑lectiva", "b) Col¬∑lectiva abans que individual", "c) S√≥n iguals"], correcta: "b", explicacio: "Primer mesures col¬∑lectives, despr√©s individuals." },
            { pregunta: "8. El RITE regula instal¬∑lacions el√®ctriques.", tipus: "vf", correcta: "f", explicacio: "Fals. Regula instal¬∑lacions t√®rmiques." },
            { pregunta: "9. Qu√® √©s un risc laboral?", tipus: "mc", opcions: ["a) Accident ja passat", "b) Possibilitat de dany", "c) Malaltia professional"], correcta: "b", explicacio: "Risc √©s la possibilitat de dany." },
            { pregunta: "10. Quina NTP tracta riscos ergon√≤mics?", tipus: "mc", opcions: ["a) NTP 387", "b) NTP 391", "c) NTP 322"], correcta: "a", explicacio: "La NTP 387 tracta riscos ergon√≤mics." },
            { pregunta: "11. L'empresari ha de proporcionar els EPI de manera gratu√Øta.", tipus: "vf", correcta: "v", explicacio: "Vertader. √âs obligaci√≥ de l'empresari." },
            { pregunta: "12. Quin article de la LPRL parla dels principis de l'acci√≥ preventiva?", tipus: "mc", opcions: ["a) Art. 14", "b) Art. 15", "c) Art. 16"], correcta: "b", explicacio: "L'article 15 estableix els principis de l'acci√≥ preventiva." },
            { pregunta: "13. El REBT √©s d'aplicaci√≥ obligat√≤ria en instal¬∑lacions de baixa tensi√≥.", tipus: "vf", correcta: "v", explicacio: "Vertader." },
            { pregunta: "14. Qu√® s√≥n les NTP?", tipus: "mc", opcions: ["a) Normes t√®cniques de prevenci√≥", "b) Lleis", "c) Reglaments"], correcta: "a", explicacio: "S√≥n Notes T√®cniques de Prevenci√≥ de l'INSST." },
            { pregunta: "15. Quina NTP tracta riscos t√®rmics?", tipus: "mc", opcions: ["a) NTP 322", "b) NTP 387", "c) NTP 391"], correcta: "a", explicacio: "La NTP 322 tracta estr√®s t√®rmic." },
            { pregunta: "16. El treballador pot negar-se a utilitzar EPI si no li agraden.", tipus: "vf", correcta: "f", explicacio: "Fals. L'√∫s √©s obligatori." },
            { pregunta: "17. Qu√® regula el RITE?", tipus: "mc", opcions: ["a) Instal¬∑lacions t√®rmiques", "b) Instal¬∑lacions el√®ctriques", "c) Prevenci√≥ de riscos"], correcta: "a", explicacio: "Regula instal¬∑lacions t√®rmiques." },
            { pregunta: "18. La investigaci√≥ d'accidents nom√©s es fa si hi ha lesions greus.", tipus: "vf", correcta: "f", explicacio: "Fals. S'investiguen tots." },
            { pregunta: "19. Quin √©s el percentatge m√≠nim per superar l'autoavaluaci√≥?", tipus: "mc", opcions: ["a) 50%", "b) 70%", "c) 90%"], correcta: "b", explicacio: "El m√≠nim √©s 70%." },
            { pregunta: "20. On has de penjar l'informe final de RA2?", tipus: "mc", opcions: ["a) A l'ordinador", "b) A Moodle i al portafolis", "c) Enviar per correu"], correcta: "b", explicacio: "S'ha de penjar a Moodle i incorporar al portafolis." }
        ];

        function generarPreguntesExamen() {
            let html = '';
            preguntesExamen.forEach((p, index) => {
                html += `<div class="examen-pregunta">`;
                html += `<p><strong>${p.pregunta}</strong></p>`;
                
                if (p.tipus === 'vf') {
                    html += `<div class="examen-opcions">`;
                    html += `<label><input type="radio" name="examen-${index}" value="v"> Vertader</label>`;
                    html += `<label><input type="radio" name="examen-${index}" value="f"> Fals</label>`;
                    html += `</div>`;
                } else {
                    html += `<div class="examen-opcions">`;
                    p.opcions.forEach((opt, optIndex) => {
                        let valor = String.fromCharCode(97 + optIndex);
                        html += `<label><input type="radio" name="examen-${index}" value="${valor}"> ${opt}</label>`;
                    });
                    html += `</div>`;
                }
                html += `<div id="feedback-${index}" class="examen-feedback"></div>`;
                html += `</div>`;
            });
            document.getElementById('examen-preguntes').innerHTML = html;
        }

        function comprovarExamen() {
            let correctes = 0;
            let total = preguntesExamen.length;
            
            preguntesExamen.forEach((p, index) => {
                let seleccio = document.querySelector(`input[name="examen-${index}"]:checked`);
                let feedbackDiv = document.getElementById(`feedback-${index}`);
                
                if (seleccio) {
                    if (seleccio.value === p.correcta) {
                        correctes++;
                        feedbackDiv.innerHTML = `‚úÖ Correcte! ${p.explicacio || ''}`;
                        feedbackDiv.className = 'examen-feedback examen-correcte';
                    } else {
                        let correctaText = p.correcta === 'v' ? 'Vertader' : p.correcta === 'f' ? 'Fals' : p.opcions[{'a':0,'b':1,'c':2}[p.correcta]];
                        feedbackDiv.innerHTML = `‚ùå Incorrecte. La resposta correcta √©s: ${correctaText}. ${p.explicacio || ''}`;
                        feedbackDiv.className = 'examen-feedback examen-incorrecte';
                    }
                    feedbackDiv.style.display = 'block';
                } else {
                    feedbackDiv.innerHTML = '‚ùå Sense respondre.';
                    feedbackDiv.className = 'examen-feedback examen-incorrecte';
                    feedbackDiv.style.display = 'block';
                }
            });
            
            let percentatge = (correctes / total * 100).toFixed(1);
            let resultatDiv = document.getElementById('examen-resultat');
            let feedbackGlobal = document.getElementById('examen-feedback-global');
            
            resultatDiv.innerHTML = `Resultat: ${correctes}/${total} (${percentatge}%)`;
            
            if (correctes >= 14) {
                resultatDiv.classList.add('examen-superat');
                resultatDiv.classList.remove('examen-no-superat');
                feedbackGlobal.innerHTML = '<p style="color:#155724;">‚úÖ SUPERAT! Est√†s preparat per a l\'examen final.</p>';
            } else {
                resultatDiv.classList.add('examen-no-superat');
                resultatDiv.classList.remove('examen-superat');
                feedbackGlobal.innerHTML = '<p style="color:#721c24;">‚ùå NO SUPERAT. Revisa els continguts i torna-ho a intentar.</p>';
            }
        }

        function reiniciarExamen() {
            preguntesExamen.forEach((_, index) => {
                let radios = document.querySelectorAll(`input[name="examen-${index}"]`);
                radios.forEach(r => r.checked = false);
                let feedbackDiv = document.getElementById(`feedback-${index}`);
                feedbackDiv.style.display = 'none';
            });
            document.getElementById('examen-resultat').innerHTML = '';
            document.getElementById('examen-feedback-global').innerHTML = '';
        }

        generarPreguntesExamen();
        document.getElementById('comprovarExamenBtn').addEventListener('click', comprovarExamen);
        document.getElementById('reiniciarExamenBtn').addEventListener('click', reiniciarExamen);

        // ===========================================
        // BOT√ì RESET MILLORAT (esborra localStorage)
        // ===========================================
        document.getElementById('resetBtn').addEventListener('click', function() {
            if (confirm('‚ö†Ô∏è Aix√≤ esborrar√† TOTES les respostes i les dades guardades. Est√†s segur?')) {
                
                document.querySelectorAll('input[type="text"], textarea, input[type="url"], select').forEach(camp => {
                    camp.value = '';
                });
                
                document.querySelectorAll('input[type="radio"]').forEach(radio => {
                    radio.checked = false;
                });
                
                for (let i = localStorage.length - 1; i >= 0; i--) {
                    let clau = localStorage.key(i);
                    if (clau.startsWith(PREFIX)) {
                        localStorage.removeItem(clau);
                    }
                }
                
                document.getElementById('resultsArea').style.display = 'none';
                
                alert('‚úÖ Totes les respostes s\'han esborrat correctament.');
            }
        });

        // ===========================================
        // SUBMIT (Preparar per enviar)
        // ===========================================
        document.getElementById('submitBtn').addEventListener('click', function() {
            let requiredIds = ['nom', 'grup', 'pregunta1', 'pregunta2', 'pregunta3', 'pregunta4', 'pregunta5', 'aprenentatge'];
            let valid = true;
            requiredIds.forEach(id => {
                let field = document.getElementById(id);
                if (!field.value.trim()) {
                    field.style.borderColor = '#D1222B';
                    valid = false;
                } else {
                    field.style.borderColor = '#ffd9d9';
                }
            });

            if (!valid) { alert('Omple tots els camps obligatoris (*)'); return; }

            window._estudiantData = {
                nom: document.getElementById('nom').value,
                grup: document.getElementById('grup').value,
                enllac: document.getElementById('enllac').value,
                autoval: document.getElementById('autovaloracio').value,
                pregunta1: document.getElementById('pregunta1').value,
                pregunta2: document.getElementById('pregunta2').value,
                pregunta3: document.getElementById('pregunta3').value,
                pregunta4: document.getElementById('pregunta4').value,
                pregunta5: document.getElementById('pregunta5').value,
                aprenentatge: document.getElementById('aprenentatge').value,
                data: new Date().toISOString()
            };

            document.getElementById('resultsArea').style.display = 'block';
            
            setTimeout(() => {
                document.getElementById('modalExplicacio').style.display = 'block';
            }, 500);
        });

        // ===========================================
        // PDF (DESCARREGAR PDF PER A MOODLE)
        // ===========================================
        document.getElementById('pdfBtn').addEventListener('click', function() {
            let d = window._estudiantData;
            if (!d) { alert('Primer prepara les dades'); return; }
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(16);
            doc.setTextColor(209,34,43);
            doc.text('INFORME D\'ACTIVITAT - RA2', 20, 20);
            
            doc.setFontSize(10);
            doc.setTextColor(0,0,0);
            doc.text('Estudiant: ' + (d.nom || ''), 20, 30);
            doc.text('Grup: ' + (d.grup || ''), 20, 37);
            doc.text('Data: ' + new Date().toLocaleDateString('ca-ES'), 20, 44);
            
            doc.text('RESPOSTES', 20, 54);
            let y = 64;
            
            let respostes = [
                '1. Incompliments: ' + (d.pregunta1 || '-'),
                '2. Articles vulnerats: ' + (d.pregunta2 || '-'),
                '3. Pla intervenci√≥: ' + (d.pregunta3 || '-'),
                '4. Riscos identificats: ' + (d.pregunta4 || '-'),
                '5. Mesures proposades: ' + (d.pregunta5 || '-'),
                '6. Aprenentatge: ' + (d.aprenentatge || '-')
            ];
            
            respostes.forEach(r => {
                let lines = doc.splitTextToSize(r, 170);
                doc.text(lines, 20, y);
                y += lines.length * 5 + 5;
            });
            
            doc.save(`RA2_informe_${d.nom?.replace(/\s+/g, '_') || 'estudiant'}.pdf`);
        });

        // ===========================================
        // JSON (EXPORTAR)
        // ===========================================
        document.getElementById('jsonBtn').addEventListener('click', function() {
            let d = window._estudiantData;
            if (!d) { 
                alert('Primer has de fer clic a "Preparar per enviar"');
                return; 
            }
            
            try {
                let jsonCont = document.getElementById('jsonContainer');
                let jsonStr = JSON.stringify(d, null, 2);
                
                if (jsonCont) {
                    jsonCont.style.display = 'block';
                    jsonCont.textContent = jsonStr;
                }
                
                const blob = new Blob([jsonStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `RA2_${d.nom?.replace(/\s+/g, '_') || 'estudiant'}.json`;
                a.style.display = 'none';
                document.body.appendChild(a);
                a.click();
                
                setTimeout(() => {
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 100);
                
                alert('‚úÖ Fitxer JSON desat a DESC√ÄRREGUES');
                
            } catch (error) {
                console.error('Error:', error);
                alert('‚ùå Error en exportar el JSON');
            }
        });

        document.getElementById('copyJsonBtn').addEventListener('click', function() {
            let d = window._estudiantData;
            if (!d) { alert('Primer prepara les dades'); return; }
            
            let jsonStr = JSON.stringify(d, null, 2);
            navigator.clipboard.writeText(jsonStr).then(() => {
                let status = document.getElementById('copyStatus');
                status.style.display = 'block';
                setTimeout(() => status.style.display = 'none', 2000);
            }).catch(() => {
                alert('‚ùå No s\'ha pogut copiar');
            });
        });
    </script>
</body>
</html>